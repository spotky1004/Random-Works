const toTest = [
    [ /\[\]\[\"([^\[\]+]+)\"\]\+\[\]/, (m, g1) => `"function ${g1}() { [native code] }"`],
    [ /(true|false)\+\[\]\[\"([^\[\]+]+)\"\]/, (m, g1, g2) => `"${g1}function ${g2}() { [native code] }"`],
    [ /\n/, () => "" ],
    [ /!\+\[\]/, () => true ],
    [ /\[\]\[\[\]\]/, () => undefined ],
    [ /undefined\+\[\]/, () => "\"undefined\"" ],
    [ /\[([^\[\]]+)\]\+undefined/, (_, g1) => `"${g1}undefined"`],
    [ /\(\"((?:[^"()]|\(\))+)\"\)\["?(\d+)"?\]/, (_, g1, g2) => `"` + g1[g2] + `"` ],
    [ /"([^"]+)"\+"([^"]+)"/, (_, g1, g2) => `"` + g1+g2 + `"` ],
    [ /(\d+)\+true/, (_, g1) => +g1 + 1 ],
    [ /!\[\]/, () => false ],
    [ /\+!\+\[\]/, () => 1 ],
    [ /true\+true/, () => 2 ],
    [ /!!\[\]/, () => false ],
    [ /!false/, () => true ],
    [ /!true/, () => false ],
    [ /false\+\[\](?!\[)/, () => "\"false\"" ],
    [ /true\+\[\](?!\[)/, () => "\"true\"" ],
    [ /\+\[\](?!(?:\)|\[))/, () => 0 ],
    [ /!0/, () => true ],
    [ /\+true/, () => 1 ],
    [ /\+(\d+)/, (_, g1) => g1 ],
    [ /(\d+)\+\[(\d+)\]/, (_, g1, g2) => `"` + g1+g2 + `"` ],
    [ /\"([^"]+)\"\+\[([^\[\]])\]/, (_, g1, g2) => `"` + g1+g2 + `"`],
    [ /\[\]\[\"[^\[\]]+\"\]\["constructor"\](?!\()/, () => "Function() { [native code] }"],
    [ /\[\]\[\"[^\[\]]+\"\]\["constructor"\]\(\"(.+)\"\)\(\)$/, (_, g1) => `anonymous() {${g1}}`],
];

function stagedParseJsf(str, depth=0) {
    for (let i = 0; i < toTest.length; i++) {
        const data = toTest[i];
        if (data[0].test(str)) {
            str = str.replace(data[0], data[1]);
            console.log(str);
            console.log("#", depth, "************************************************");
            stagedParseJsf(str, depth+1);
            return str;
        }
    }
}

/** Case 1 */
// stagedParseJsf(`+!![]+[+[]]`);

/** Case 2 */
// stagedParseJsf(`[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+
// (!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]][([][(![]+[])[+[]]+
// ([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+
// (!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+
// (!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+
// (!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[+!+[]+[+[]]]+
// ([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+
// (!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+
// (![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+
// (!![]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+
// ([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+
// (!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]`);

/** Case 3 */
stagedParseJsf(`[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]+(!![]+[])[+[]]+(![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[!+[]+!+[]+[+[]]]+[+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[!+[]+!+[]+[+[]]])()`);
